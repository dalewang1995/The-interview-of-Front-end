# 小程序的启动机制

* 冷启动：用户首次打开小程序，或者小程序被微信销毁后重新打开，需要重新加载启动（onLaunch->onShow）

* 热启动：用户已经打开过小程序，在指定时间内再次打开小程序，此时无需重新启动，只是将小程序从后台切换到前台（onShow）

# 小程序的销毁机制

* 主动销毁：小程序没有重启的概念，当小程序进入后台之后，会维持一段时间的运行状态，在超过指定时间之后（一般是5分钟）会被微信主动销毁
* 被动销毁：当小程序在运行过程中在短时间内（一般是5s）连续收到两次以上的内存告警，小程序将会被微信销毁

# 小程序的更新机制

小程序冷启动（重新加载启动）时如果发现有新版本，将会异步下载版本的代码包，并同时将客户端本地的包进行启动，这时最新的代码实际上没有被加载，需要等到小程序下一个冷启动时才会加载，如果需要马上版本更新，可以使用wx.getUpdateManager来手动处理

# 小程序框架对比

多端框架基本实现原理：以JavaScript为基础选定一个DSL框架，以这个DSL框架为基准在各端分别编译出不同的代码，各端分别有一个运行时框架或兼容组件库来保证代码正确运行

* Taro：React语法、集成了ESLint语法检查、支持TS、支持六端、具有跨端组件库，具有Taro-cli可以转译代码（接入成本小）、支持MobX等多种状态管理工具
* WePY：类Vue语法、支持TS
* uni-app：Vue语法，具有自研IDE、支持TS、支持六端
* mp-vue（美团）：Vue语法、支持TS
* chameleon（滴滴）：类Vue、不支持TS

# Taro框架实现原理

Taro框架实现分为两部分：

* 编译框架：前置编译框架，使用Babel一系列模块来完成代码的编译，主要分为以下几个方面
  * 使用Babylon解析代码生成AST，使用Babel-traverse遍历AST语法树，使用Babel-types工具库来完成对AST的增删改查，最终生成目标代码
  * 将JSX文件转换为.wxml模版、生成小程序的配置文件、页面等组件代码
  * 将render函数重命名为_createData，一个创建数据的方法，JSX引用的数据都将被创建然后放到小程序的data中
* 运行时框架：负责把编译后的代码运行在本不能运行的对应环境中，相当于浏览器的polyfill，并抹平平台差异，采用微信小程序的组件库和api作为运行时的标准
  * 标准运行时框架：@taro/taro
  * 标准基础组件库：@tarojs/components
  * 标准端能力Api：@taro/taro
  * createApp、createPage、createComponent这三个方法在编译时注入到代码中，在运行时创建程序、页面和组件
  * 运行时将setState转换成setData、生命周期转换、事件处理函数转换、api进行Promise化

