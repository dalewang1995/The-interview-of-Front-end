# 发布-订阅模式实现

```javascript
/**
 * 发布-订阅事件处理器
 */
class EventEmitter {
  constructor() {
    this.eventMap = Object.create(null)
  }
  /**
   * 事件订阅
   * @param {String} eventName 事件名
   * @param {Function} func 执行函数
   */
  on(eventName, func) {
    const events = this.eventMap[eventName]
    if (Array.isArray(events) && typeof func === 'function') {
      this.eventMap[eventName].push(func)
    } else {
      this.eventMap[eventName] = [func]
    }
  }
  /**
   * 事件触发
   * @param {String} eventName 事件名
   */
  emit(eventName) {
    const events = this.eventMap[eventName]
    const args = Array.prototype.slice.call(arguments, 1)
    const that = this
    if (Array.isArray(events)) {
      events.forEach((event) => {
        event.apply(that, args)
      })
    }
  }
  /**
   * 事件移除
   * @param {String} eventName 事件名
   * @param {Function} func 执行函数
   */
  off(eventName, func) {
    const events = this.eventMap[eventName]
    if (Array.isArray(events) && typeof func === 'function') {
      this.eventMap[eventName] = events.filter((event) => {
        return event !== func
      })
    }
  }
  /**
   * 事件一次订阅
   * @param {String} eventName 事件名
   * @param {Function} func 执行函数
   */
  once(eventName, func) {
    const that = this
    function newFunc() {
      const args = Array.prototype.slice.call(arguments, 0)
      func.apply(that, args)
      this.off('eventName', newFunc)
    }
    this.on(eventName, newFunc)
  }
}

export default EventEmitter
```

